# MySQL 서버의 데이터 암호화
- TDE(Transparent Data Encryption)
  - MySQL 내부와 사용자 입장에서는 아무런 차이가 없음
  - Data at Rest Encryption : 디스크에 저장된 상태(at Rest)에서만 암호화됨
## 2단계 키관리
- 마스터 키(프라이빗 키) , 테이블스페이스 키
- 외부 키 관리 솔루션 또는 디스크의 파일에서 마스터 키를 가져옴, 암호화된 테이블 생성시마다 테이블스페이스 키 발급, MySQL 서버는 마스터 키를 이용해 테이블스페이스 키를 암호화해서 각 테이블의 데이터 파일 헤더에 저장
- 마스터키는 외부 파일 이용하기 때문에 노출 가능성 있음, 주기적 변경 필요
## 암호화와 성능
- 암호화 테이블 경우 읽기는 3~5배 느림, 쓰기는 5~6배 느림
## 암호화와 복제
- MySQL 서버에서 기본적으로 모든 노드는 각자의 마스터 키를 할당
- 소스 서버와 레플리카 서버 모두 서로 각자의 마스터 기와 테이블 키 관리
- 키링 파일을 데이터 백업과 별도로 백업한다면 마스터 키 로테이션 명령으로 마스터 키가 언제 변경되었는지 기억 필요
# keyring_file 플러그인
- 테이블스페이스 키를 암호화하기 위한 마스터 키를 디스크의 파일로 관리, 평문으로 디스크에 저장
# 테이블 암호화
- 키링 플러그인은 마스터 키를 생성하고 관리하는 부분까지만 담당, 암호화된 테이블을 생성하고 활용하는 방법은 모두 동일
## 테이블 생성
- `ENCRYTION='Y'`
## 응용 프로그램 암호화와의 비교
```sql
CREATE TABLE app_user (
  id BIGINT,
  enc_bith_year VARCHAR(50), // 응용 프로그램에서 미리 암호화
  ...
  PRIMARY KEY (id),
  INDEX ix_birthyear (birth_year)
)
```
- 다음과 같은 동일 값 검색은 가능
```sql
SELECT * FROM app_user WHERE enc_birth_year=#{encrytedYear};
```
- 범위 검색이나 정렬은 불가능 - 이미 암호화된 값으로 정렬하기에 암호화 전 값으로는 정렬 불가
- TDE 사용 시 MySQL 서버는 인덱스 작업 처리 후 디스크 저장시에만 암호화하기에 제약 없음
## 테이블스테이스 이동
- 테이블을 다른 서버로 복사 / 특정 테이블의 데이터 파일만 백업했다 복구
# 언두 로그 및 리두 로그 암호화
- MySQL 서버는 리두 로그나 언두 로그를 평문으로 저장하다 암호화가 활성화되면 그 때부터 생성되는 리두 로그나 언두 로그만 암호화해서 저장
# 바이너리 로그 암호화
- 바이너리 로그는 의도적으로 상당히 긴 시간동안 보관하는 서비스도 존재
- 증분 백업을 위해 바이너리 로그를 보관하기도 함
