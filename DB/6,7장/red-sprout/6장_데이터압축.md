# 페이지 압축
- `Transparent Page Compression`
  - MySQL 서버가 디스크에 저장하는 시점에 데이터 페이지 압축되어 저장, 읽어올 때 해제 - MySQL 서버의 내부 코드에서는 압축 여부와 상관없이 투명하게 작동
  - 압축 결과는 예측 불가능 but, 테이블은 동일
- `Punch hole` 사용, but 일부 파일 시스템에서만 사용
- 많이 사용 X, 사용 시 `COMPRESSION` 사용

# 테이블 압축
- 제약 없음
- 단점
  - 버퍼 풀 공간 활용률 낮음
  - 쿼리 처리 성능 낮음
  - 번번한 데이터 변경시 압축률 떨어짐
## 압축 테이블 생성
- `ROW_FORMAT=COMPRESSED`
- `KEY_BLOCK_SIZE` : 목표 크기, 2n(n >= 2)으로 설정 가능, 페이지 크기 32 KB, 64 KB 사용 불가
- 원본 데이터의 압축 결과가 목표 크기보다 작거나 같을 때까지 반복해서 페이지를 스플릿 - 목표 크기 설정 중요
## KEY_BLOCK_SIZE 결정
- 압축 실패율은 낮으면서 압축 효율은 좋은 쪽을 선택
- 4 KB / 8 KB 중 선택하는 것이 일반적
- 압축 실패율이 높다고 압축을 사용하지 말아야한다는 것을 의미 X
- 압축을 고려하지 않는 경우
  - 테이블의 데이터가 매우 빈번하게 조회되고 변경
  - 압축 알고리즘은 많은 CPU 자원 소모
## 압축된 페이지의 버퍼 풀 적재 및 사용
- LRU 리스트는 압축된 페이지, 안된 페이지 모두 가질 수 있음
- `Unzip_LRU` 리스트 별도 관리
- 과정
  - InnoDB 버퍼 풀의 공간이 필요한 경우 LRU 리스트에서 원본 데이터 페이지(압축된 형태)는 유지, Unzip_LRU 리스트에서 압축 해제된 버전은 제거해서 버퍼 풀의 공간을 확보
  - 압축된 데이터 페이지가 자주 사용되는 경우 Unzip_LRU 리스트에 압축 해제된 페이지를 계속 유지하면서 압축 및 해제 작업을 최소화
  - 압축된 데이터 페이지가 사용되지 않아서 LRU 리스트에서 제거되는 경우에는 Unzip_LRU 리스트에서도 함께 제거됨
- CPU 사용량 높으면 Unzip_LRU 비율 높힘
- Disk IO 사용량 높으면 Unzip_LRU 비율 낮춰 버퍼 풀 공간 확보
